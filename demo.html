<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChefGenius FLAN-T5 Recipe Generator Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .input-panel, .output-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4a5568;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2d3748;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .ingredients-input {
            min-height: 80px;
            resize: vertical;
        }
        
        .generate-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .recipe-output {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 400px;
            border: 2px dashed #e2e8f0;
        }
        
        .recipe-content {
            display: none;
        }
        
        .recipe-title {
            font-size: 1.8rem;
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .recipe-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }
        
        .meta-item {
            text-align: center;
        }
        
        .meta-value {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1rem;
        }
        
        .meta-label {
            font-size: 0.9rem;
            color: #718096;
            margin-top: 5px;
        }
        
        .ingredients-section, .instructions-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .ingredients-list {
            list-style: none;
            padding: 0;
        }
        
        .ingredients-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
        }
        
        .instructions-list {
            list-style: none;
            counter-reset: step-counter;
        }
        
        .instructions-list li {
            counter-increment: step-counter;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            position: relative;
            padding-left: 60px;
        }
        
        .instructions-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 15px;
            top: 15px;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .model-info {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .model-info h3 {
            margin-bottom: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 10px;
        }
        
        .status-online {
            background: #48bb78;
            box-shadow: 0 0 10px rgba(72, 187, 120, 0.6);
        }
        
        .status-offline {
            background: #f56565;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ChefGenius FLAN-T5 Demo</h1>
            <p>Experience AI-powered recipe generation with Google's FLAN-T5-Large model</p>
        </div>
        
        <div class="model-info">
            <h3>Model Status: FLAN-T5-Large (770M parameters) <span id="statusIndicator" class="status-indicator status-offline"></span></h3>
            <p>Optimized for RTX 4090 | Hardware acceleration enabled | Training ready</p>
        </div>
        
        <div class="demo-grid">
            <div class="input-panel">
                <h2 class="panel-title">Recipe Parameters</h2>
                <form id="recipeForm">
                    <div class="form-group">
                        <label for="ingredients">Ingredients (comma-separated):</label>
                        <textarea 
                            id="ingredients" 
                            name="ingredients" 
                            class="ingredients-input" 
                            placeholder="chicken breast, garlic, olive oil, rosemary, lemon"
                            required
                        ></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="cuisine">Cuisine Type:</label>
                        <select id="cuisine" name="cuisine">
                            <option value="">Any Cuisine</option>
                            <option value="italian">Italian</option>
                            <option value="mexican">Mexican</option>
                            <option value="asian">Asian</option>
                            <option value="indian">Indian</option>
                            <option value="mediterranean">Mediterranean</option>
                            <option value="american">American</option>
                            <option value="french">French</option>
                            <option value="thai">Thai</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="difficulty">Difficulty Level:</label>
                        <select id="difficulty" name="difficulty">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="servings">Servings:</label>
                        <input type="number" id="servings" name="servings" min="1" max="12" value="4">
                    </div>
                    
                    <div class="form-group">
                        <label for="dietary">Dietary Restrictions:</label>
                        <select id="dietary" name="dietary">
                            <option value="">None</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="vegan">Vegan</option>
                            <option value="gluten-free">Gluten-Free</option>
                            <option value="dairy-free">Dairy-Free</option>
                            <option value="low-carb">Low-Carb</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="generate-btn" id="generateBtn">
                        Generate Recipe with FLAN-T5
                    </button>
                </form>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>FLAN-T5 is crafting your recipe...</p>
                </div>
            </div>
            
            <div class="output-panel">
                <h2 class="panel-title">Generated Recipe</h2>
                <div class="recipe-output" id="recipeOutput">
                    <div style="text-align: center; color: #718096; margin-top: 150px;">
                        <h3>Your AI-generated recipe will appear here</h3>
                        <p>Fill in the parameters and click "Generate Recipe" to see FLAN-T5 in action!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check backend status
        async function checkBackendStatus() {
            try {
                const response = await fetch('http://localhost:8000/health');
                if (response.ok) {
                    document.getElementById('statusIndicator').className = 'status-indicator status-online';
                    return true;
                }
            } catch (error) {
                console.log('Backend not available, using demo mode');
            }
            return false;
        }

        // Demo recipe data for when backend is not available
        const demoRecipes = [
            {
                title: "Herb-Crusted Chicken with Lemon",
                description: "A delicious Mediterranean-style chicken dish with fresh herbs and citrus",
                prep_time: 15,
                cook_time: 25,
                servings: 4,
                difficulty: "medium",
                ingredients: [
                    { name: "chicken breast", amount: 4, unit: "pieces" },
                    { name: "garlic", amount: 3, unit: "cloves" },
                    { name: "olive oil", amount: 3, unit: "tbsp" },
                    { name: "fresh rosemary", amount: 2, unit: "tbsp" },
                    { name: "lemon", amount: 1, unit: "whole" }
                ],
                instructions: [
                    "Preheat your oven to 400°F (200°C) and prepare a baking dish with olive oil",
                    "Mince the garlic and chop the fresh rosemary finely",
                    "Season the chicken breasts with salt and pepper on both sides",
                    "Mix garlic, rosemary, and olive oil in a small bowl to create an herb paste",
                    "Rub the herb mixture all over the chicken breasts, ensuring even coverage",
                    "Place chicken in the prepared baking dish and squeeze lemon juice over the top",
                    "Bake for 22-25 minutes until internal temperature reaches 165°F (74°C)",
                    "Let rest for 5 minutes before slicing and serving with lemon wedges"
                ]
            }
        ];

        // Generate recipe function
        async function generateRecipe(formData) {
            const isBackendAvailable = await checkBackendStatus();
            
            if (isBackendAvailable) {
                try {
                    const response = await fetch('http://localhost:8000/api/v1/recipes/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            ingredients: formData.get('ingredients').split(',').map(i => i.trim()),
                            cuisine: formData.get('cuisine'),
                            difficulty: formData.get('difficulty'),
                            servings: parseInt(formData.get('servings')),
                            dietary_restrictions: formData.get('dietary') ? [formData.get('dietary')] : []
                        })
                    });
                    
                    if (response.ok) {
                        return await response.json();
                    }
                } catch (error) {
                    console.log('API call failed, using demo mode');
                }
            }
            
            // Demo mode - return a demo recipe
            return demoRecipes[0];
        }

        // Display recipe function
        function displayRecipe(recipe) {
            const output = document.getElementById('recipeOutput');
            
            const ingredientsList = recipe.ingredients.map(ing => 
                `<li><span>${ing.amount} ${ing.unit} ${ing.name}</span></li>`
            ).join('');
            
            const instructionsList = recipe.instructions.map(instruction => 
                `<li>${instruction}</li>`
            ).join('');
            
            output.innerHTML = `
                <div class="recipe-content" style="display: block;">
                    <h3 class="recipe-title">${recipe.title}</h3>
                    
                    <div class="recipe-meta">
                        <div class="meta-item">
                            <div class="meta-value">${recipe.prep_time}</div>
                            <div class="meta-label">Prep Time (min)</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-value">${recipe.cook_time}</div>
                            <div class="meta-label">Cook Time (min)</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-value">${recipe.servings}</div>
                            <div class="meta-label">Servings</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-value">${recipe.difficulty}</div>
                            <div class="meta-label">Difficulty</div>
                        </div>
                    </div>
                    
                    <div class="ingredients-section">
                        <h4 class="section-title">Ingredients</h4>
                        <ul class="ingredients-list">
                            ${ingredientsList}
                        </ul>
                    </div>
                    
                    <div class="instructions-section">
                        <h4 class="section-title">Instructions</h4>
                        <ol class="instructions-list">
                            ${instructionsList}
                        </ol>
                    </div>
                </div>
            `;
        }

        // Form submission handler
        document.getElementById('recipeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('generateBtn');
            const loading = document.getElementById('loading');
            
            // Show loading state
            submitBtn.disabled = true;
            loading.style.display = 'block';
            
            try {
                const formData = new FormData(e.target);
                const recipe = await generateRecipe(formData);
                displayRecipe(recipe);
            } catch (error) {
                console.error('Error generating recipe:', error);
                document.getElementById('recipeOutput').innerHTML = `
                    <div style="text-align: center; color: #f56565; margin-top: 150px;">
                        <h3>Error generating recipe</h3>
                        <p>Please try again or check your inputs.</p>
                    </div>
                `;
            } finally {
                // Hide loading state
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkBackendStatus();
        });
    </script>
</body>
</html>